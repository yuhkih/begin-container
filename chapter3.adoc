
== コンテナを使う上での暗黙の了解とPULL

ここでは、演習に入る前に、少し寄り道して `docker pull` についてよく見てみます。

=== Docker Hub 上のイメージを使用する

単純にコンテナをダウンロードするだけであれば、

```
docker pull nginx
```

でダウンロード(`PULL`)する事ができます。

`docker run` というコマンドを前の章で使いましたが、実は、 `docker run` コマンドは `docker pull` と `docker create` と `docker start` の3つのコマンドをまとめたコマンドです。

以下に `docker` で良く使うコマンドの関係性を図示してみました。

image::images/2-1-dockerhub.png[left]

`docker` の `イメージ` は、`レポジトリ` と呼ばれる場所に保管されています。 `レポジトリ` は、インターネット上にもありますし、 `コンテナ` が実行されるローカルにもあります。

通常、一つの `レポジトリ` には、 一つの `イメージ` のいろいろなバージョンが保管されます。さらに、この `レポジトリ` がたくさん集まった場所を `レジストリ` と呼びます。インターネット上にある `レジストリ` で一番、有名なのは `Docker Hub` です。 `docker` コマンドを実行すると特に何も指定しなくても、 `Docker Hub` を参照に行くようになっています。

`docker run` を実行すると、インターネット上の `Docker Hub レポジトリ` から、ローカルの `レポジトリ` に `イメージ` がダウンロード( `pull` )され、そこから `コンテナ` が `create` され `start` で起動されます。

また、既にローカルに `pull` されたイメージがある場合は、`docker run` を実行してもインターネットから再ダウンロード( `pull` )される事はありません。

`create` と `start` はとりあえず置いておいて、ここでは `pull` に注目します。


```
docker pull nginx
```


では、単に `nginx` と指定していますが、幾つかの暗黙の省略が含まれています。

`docker` コマンドでは、 `nginx` と指定しただけで https://hub.docker.com[Docker Hub^] というコンテナレジストリにアクセスして、 `nginx` という名前のコンテナで `latest` というタグが付いたものを探してダウンロード( `pull` )してきます。

なので省略されていますが、上のコマンドは以下のコマンドを実行している事になります。

```
docker pull nginx:latest
```

省略を補完してくれるのは慣れてくると便利な機能なのですが、動作を理解するためには混乱するかもしれません。

タグは、 `:(コロン)` を挟んで付加します。
タグの `latest` 部分は、ユーザーがイメージを作成する時に自由に付ける事ができます。`latest` は予約語として最新番を表すものとして決まっていますが、使い方は自由です。`stable` のように付けたり、`stable-1.20` のようにしたり、`1.20` のように数字だけを使っても大丈夫です。

```
docker pull nginx:1.20
```

このようにタグは、イメージのバージョンを管理するために使われます。使い方は自由なので、イメージ毎に違います。

`Registry` 上のイメージにどんなタグが付いているかの一覧の取得は、標準の `docker` コマンドではサポートされておらず、 https://registry.hub.docker.com/_/nginx?tab=tags[Docker Hub^] にアクセスして確認する必要があります。


=== Docker Hub 以外のイメージを使用する

コンテナのイメージを  https://hub.docker.com[Docker Hub^] 以外のレジストリからダウンロード(`pull`)してきたい場合は、明示的に指定する必要があります。例えば、

```
docker pull quay.io/centos/centos
```

は、 `quay.io` という `Red Hat` 社のコンテナレジストリの `centos/centos` という `レポジトリ` 名 の `latest` という `タグ` が付いたものを(ローカルに無ければ) ダウンロード( `pull` )してきます。

この例であげている `レポジトリ` 名 `centos/centos` は、名前の中に `/` が入っています。 `レポジトリ` 名は、このように `/` が中に入っていたり、単純に `centos` のように `/` が無い名前までいろいろあり得ます。必ずしも `/` があるからと言って、 `レポジトリ` 名と `レジストリ` 名の区切りという訳ではないので、慣れる必要があります。

上記のコマンドは以下を示している事になります。

```
docker pull quay.io/centos/centos:latest
```

ダウンロードしてきた `nginx` というイメージは、ローカルに保存され、次回、同じイメージが要求された時には、既にダウンロードされたものが使用されます。
